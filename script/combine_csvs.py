import getopt
import sys
import pandas as pd
from sklearn import preprocessing
from sklearn.preprocessing import Imputer
from time import time

def pop_udp(df):
    df.pop('usport')
    df.pop('udport')
    df.pop('same_usport')
    df.pop('same_udport')
    df.pop('ulen')
    df.pop('uchksum')
    return df


def combine_csvs(files, output_file):
    columns = pd.read_csv(files[0], index_col=0).columns
    combined = pd.DataFrame(columns=columns)
    for file in files:
        df = pd.read_csv(file, index_col=0)
        combined = combined.append(df, ignore_index=True, sort=False)

    combined.pop('ioptions')
    combined = pop_udp(combined)
    le = preprocessing.LabelEncoder()
    combined['iflags'] = le.fit_transform(combined['iflags'].astype(str))
    combined = combined.fillna(0)
    # combined.pop('Unnamed: 0')
    # print(combined)
    combined.to_csv(output_file, index=False)



def main(argv):
    """ Main program """
    t0 = time()
    input_files = argv[:-1]
    output_file = argv[-1]

    combine_csvs(input_files,output_file)

    t1 = time()
    print(t1-t0)

    return

if __name__ == "__main__":
    main(sys.argv[1:])

